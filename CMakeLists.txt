cmake_minimum_required(VERSION 3.16)

project(mobile_robot_model)

set(CMAKE_BUILD_TYPE Debug) 

include_directories(include)

find_package(OpenCV  REQUIRED)
include_directories(${OpenCV_INCLUDE_DIRS})

find_package(Eigen3 REQUIRED)
include_directories(${EIGEN3_INCLUDE_DIR})

set(SOURCES 
    src/main.cpp
    src/Robot.cpp
    src/RangeFinder.cpp)

set(HEADERS 
    include/Robot.hpp
    include/RangeFinder.hpp)

add_executable(${PROJECT_NAME}_exe ${SOURCES} ${HEADERS})
target_link_libraries(${PROJECT_NAME}_exe ${OpenCV_LIBS} ${Eigen3})

add_library(${PROJECT_NAME} SHARED ${SOURCES} ${HEADERS})
target_link_libraries(${PROJECT_NAME} ${OpenCV_LIBS} ${Eigen3})

install(DIRECTORY include/ DESTINATION ${CMAKE_INSTALL_PREFIX}/include/${PROJECT_NAME})

########### Install library ###########
install (TARGETS ${PROJECT_NAME} LIBRARY DESTINATION ${CMAKE_INSTALL_PREFIX}/lib)
export (TARGETS ${PROJECT_NAME} FILE ${CMAKE_BINARY_DIR}/${PROJECT_NAME}-export-build.cmake)
set (EXPORT_INCLUDE_FILE ${PROJECT_NAME}Config.cmake)
file(WRITE ${CMAKE_BINARY_DIR}/${EXPORT_INCLUDE_FILE} "# This file is automatically generated\n")
file(APPEND ${CMAKE_BINARY_DIR}/${EXPORT_INCLUDE_FILE} "###################\n")
file(APPEND ${CMAKE_BINARY_DIR}/${EXPORT_INCLUDE_FILE} "# List of include directories for exported targets\n\n")
file(APPEND ${CMAKE_BINARY_DIR}/${EXPORT_INCLUDE_FILE} "set(${PROJECT_NAME}_INCLUDE_DIRS ${${PROJECT_NAME}_INCLUDE_DIRS} CACHE STRING \"include dir for ${PROJECT_NAME}\")\n")
file(APPEND ${CMAKE_BINARY_DIR}/${EXPORT_INCLUDE_FILE} "set(${PROJECT_NAME}_LIBRARIES ${CMAKE_INSTALL_PREFIX}/lib/lib${PROJECT_NAME}.so CACHE STRING \"library dir for ${PROJECT_NAME}\")\n")


install (FILES ${CMAKE_BINARY_DIR}/${PROJECT_NAME}Config.cmake
         DESTINATION ${CMAKE_INSTALL_PREFIX})

SET(CPACK_GENERATOR "DEB") 
SET(CPACK_DEBIAN_PACKAGE_MAINTAINER "Zurlo Dario")
SET(CPACK_DEBIAN_PACKAGE_NAME "mobile_robot_model")
SET(CPACK_DEBIAN_PACKAGE_VERSION "0.1") 
SET(CPACK_DEBIAN_PACKAGE_RELEASE "1")
Include(CPack)